package pixiv

import "testing"

func TestPixivDescriptionRegex(t *testing.T) {
	demoPixivPage := "<!DOCTYPE html>\n<html lang=\"zh-CN\"xmlns:wb=\"http://open.weibo.com/wb\"><head><meta name=\"viewport\" content=\"width=1366\"><script type=\"text/javascript\" nonce=\"f3801adb9a704459b145adc867f\" src=\"//local.adguard.org?ts=1666053215215&amp;type=content-script&amp;dmn=www.pixiv.net&amp;pth=%2Fusers%2F87178177&amp;app=brave.exe&amp;css=3&amp;js=1&amp;rel=1&amp;rji=1&amp;sbe=0&amp;stealth=1&amp;uag=\"></script>\n<script type=\"text/javascript\" nonce=\"f3801adb9a704459b145adc867f\" src=\"//local.adguard.org?ts=1666053215215&amp;name=AdGuard%20Extra&amp;name=AdGuard%20Popup%20Blocker&amp;type=user-script\"></script><link rel=\"shortcut icon\"  href=\"https://www.pixiv.net/favicon.ico\"><title>Nya Candy - pixiv</title><link rel=\"canonical\" href=\"https://www.pixiv.net/users/87178177\"><link rel=\"alternate\" hreflang=\"ja\" href=\"https://www.pixiv.net/users/87178177\"><link rel=\"alternate\" hreflang=\"en\" href=\"https://www.pixiv.net/en/users/87178177\"><meta property=\"twitter:card\" content=\"summary\"><meta property=\"twitter:site\" content=\"@pixiv\"><meta property=\"twitter:title\" content=\"Nya Candy\"><meta property=\"twitter:image\" content=\"https://i.pximg.net/user-profile/img/2022/10/18/13/15/39/23480334_d7199329917df0086e9ad9f03bf7bc12_170.png\"><meta property=\"twitter:description\" content=\"lc499@Crossbell\"><meta property=\"og:site_name\" content=\"pixiv\"><meta property=\"fb:app_id\" content=\"140810032656374\"><meta property=\"og:title\" content=\"Nya Candy\"><meta property=\"og:type\" content=\"article\"><meta property=\"og:image\" content=\"https://i.pximg.net/user-profile/img/2022/10/18/13/15/39/23480334_d7199329917df0086e9ad9f03bf7bc12_170.png\"><meta property=\"og:description\" content=\"lc499@Crossbell\"><meta name=\"description\" content=\"pixiv\"><script>var _gaq = _gaq || [];_gaq.push(['_setAccount', 'UA-1830249-3']);_gaq.push(['_setDomainName', 'pixiv.net']);_gaq.push(['_setCustomVar', 1, 'login', 'yes', 3]);_gaq.push(['_setCustomVar', 3, 'plan', 'normal', 1]);_gaq.push(['_setCustomVar', 5, 'gender', '', 1]);_gaq.push(['_setCustomVar', 6, 'user_id', \"87178177\", 1]);_gaq.push(['_setCustomVar', 11, 'lang', \"zh\", 1]);_gaq.push(['_setCustomVar', 12, 'illustup_flg', 'not_uploaded', 3]);_gaq.push(['_setCustomVar', 13, 'user_id_per_pv', \"87178177\", 3]);_gaq.push(['_setCustomVar', 27, 'p_ab_d_id', \"1115087350\", 3]);_gaq.push(['_setCustomVar', 29, 'default_service_is_touch', 'no', 3]);</script><meta id=\"meta-pixiv-tests\" name=\"pixiv-tests\" content='{\"accounts_pigya_apple\":true,\"accounts_pigya_facebook\":true,\"accounts_pigya_google\":true,\"accounts_pigya_twitter\":true,\"accounts_pigya_weibo\":true,\"ads_aps_email_hash\":true,\"anniversary15_guideline_release\":true,\"anniversary15_release\":true,\"ab_illlust_series_spa_dev\":true,\"ab_illlust_series_mobile_spa_dev\":true,\"profile_genre_page_novel_series_component\":true,\"illust_reply_tree\":true,\"ab_manga_each_lang_populer_works\":true,\"ab_manga_new_viewer\":true,\"ab_touch_manga_new_viewer\":true,\"nagisa\":true,\"novel_12th_premium_covers\":true,\"novel_never_hide_overlay_ads_on_viewer_h100\":true,\"touch_novel_follow_watchlist_tab\":true,\"recommend_tutorial_20191213\":true,\"show_age_on_profile\":true,\"show_prefecture_on_profile\":true,\"touch_top_jack\":true,\"www_premium_link_text\":true,\"www_profile_edit_spa\":true,\"toggles\":{\"toggle_factory_custom_cover\":true,\"toggle_factory_custom_cover_release_modal\":true,\"chatbot_settings_page_enable\":true,\"toggle_illust_manga_reupload\":true,\"toggle_lemon_prepare\":true,\"toggle_lemon_stop_new\":true,\"toggle_lemon_stop_all\":true,\"toggle_manga_genre_tag\":true,\"toggle_manga_series_reserve\":true,\"toggle_manga_book_style_tateyomi\":true,\"toggle_novel_close_bungei\":true,\"toggle_novel_editors_choise\":true,\"toggle_novel_hide_overlay_ads_on_viewer\":true,\"toggle_novel_word_count\":true,\"set_language_at_upload\":true,\"comment_off\":true,\"clipstudio_next_js\":true}}'><link rel=\"stylesheet\" href=\"https://source.pixiv.net/www/js/build/vendors~spa.5bd0246d2d7aec9c9238.css\" crossorigin=\"anonymous\"><link rel=\"stylesheet\" href=\"https://source.pixiv.net/www/js/build/21.4af3be5ba6ffa2c78bdf.css\" crossorigin=\"anonymous\"><link rel=\"stylesheet\" href=\"https://source.pixiv.net/www/js/build/spa.84ddbf24e98807ddd31f.css\" crossorigin=\"anonymous\"><script src=\"https://source.pixiv.net/www/js/build/runtime.4b3aee77d4985f890017.js\" charset=\"utf8\" crossorigin=\"anonymous\"defer></script><script src=\"https://source.pixiv.net/www/js/build/vendors~spa.a7368647e31d4a8b0a81.js\" charset=\"utf8\" crossorigin=\"anonymous\"defer></script><script src=\"https://source.pixiv.net/www/js/build/21.b872591e3e312992a469.js\" charset=\"utf8\" crossorigin=\"anonymous\"defer></script><script src=\"https://source.pixiv.net/www/js/build/spa.bf4fed39767b2c371583.js\" charset=\"utf8\" crossorigin=\"anonymous\"defer></script><link rel=\"preload\" as=\"script\" href=\"https://source.pixiv.net/www/js/build/moment-zh.5035186e5e3cecc5d0db.js\" crossorigin=\"anonymous\"><script>\n        console.log(\"%c\"+\"/* pixiv Bug Bounty Program */\",\"color: #0096fa; font-weight: bold;\");\n    console.log(\"We have a bug bounty program on HackerOne. \\nIf you find a vulnerability in our scope, please report it to us.\");\n    console.log(\"https://hackerone.com/pixiv\");\n</script><link rel=\"apple-touch-icon\" sizes=\"180x180\" href=\"https://source.pixiv.net/common/images/apple-touch-icon.png?20200601\"><link rel=\"manifest\" href=\"/manifest.json\"><meta name=\"global-data\" id=\"meta-global-data\" content='{\"token\":\"52579f10b940678b233c560d3a832eb7\",\"services\":{\"booth\":\"https://api.booth.pm\",\"sketch\":\"https://sketch.pixiv.net\",\"vroidHub\":\"https://hub.vroid.com\",\"accounts\":\"https://accounts.pixiv.net/\"},\"oneSignalAppId\":\"b2af994d-2a00-40ba-b1fa-684491f6760a\",\"publicPath\":\"https://source.pixiv.net/www/js/build/\",\"commonResourcePath\":\"https://s.pximg.net/common/\",\"development\":false,\"userData\":{\"id\":\"87178177\",\"pixivId\":\"user_azyk5423\",\"name\":\"Nya Candy\",\"profileImg\":\"https://i.pximg.net/user-profile/img/2022/10/18/13/15/39/23480334_d7199329917df0086e9ad9f03bf7bc12_50.png\",\"profileImgBig\":\"https://i.pximg.net/user-profile/img/2022/10/18/13/15/39/23480334_d7199329917df0086e9ad9f03bf7bc12_170.png\",\"premium\":false,\"xRestrict\":0,\"adult\":true,\"safeMode\":false,\"illustCreator\":false,\"novelCreator\":false},\"adsData\":null,\"miscData\":{\"consent\":{\"gdpr\":true},\"policyRevision\":false,\"grecaptcha\":{\"recaptchaEnterpriseScoreSiteKey\":\"6LfF1dcZAAAAAOHQX8v16MX5SktDwmQINVD_6mBF\"},\"info\":{\"id\":\"8701\",\"title\":\"现已支持选择接收来自特定账号的私讯\",\"createDate\":\"2022-10-17 18:00:00\"},\"isSmartphone\":false},\"premium\":{\"novelCoverReupload\":true},\"mute\":[]}'><meta name=\"preload-data\" id=\"meta-preload-data\" content='{\"timestamp\":\"2022-10-18T13:15:52+09:00\",\"user\":{\"87178177\":{\"userId\":\"87178177\",\"name\":\"Nya Candy\",\"image\":\"https://i.pximg.net/user-profile/img/2022/10/18/13/15/39/23480334_d7199329917df0086e9ad9f03bf7bc12_50.png\",\"imageBig\":\"https://i.pximg.net/user-profile/img/2022/10/18/13/15/39/23480334_d7199329917df0086e9ad9f03bf7bc12_170.png\",\"premium\":false,\"isFollowed\":false,\"isMypixiv\":false,\"isBlocking\":false,\"background\":null,\"sketchLiveId\":null,\"partial\":1,\"acceptRequest\":false,\"sketchLives\":[],\"following\":1,\"followedBack\":false,\"comment\":\"lc499@Crossbell\",\"commentHtml\":\"lc499@Crossbell\",\"webpage\":null,\"social\":{\"twitter\":{\"url\":\"https://twitter.com/CandiiRua\"}},\"canSendMessage\":true,\"region\":{\"name\":\"日本\",\"region\":\"JP\",\"prefecture\":null,\"privacyLevel\":\"0\"},\"age\":{\"name\":\"22岁\",\"privacyLevel\":\"0\"},\"birthDay\":{\"name\":\"4月1日\",\"privacyLevel\":\"0\"},\"gender\":{\"name\":\"其他\",\"privacyLevel\":\"0\"},\"job\":{\"name\":\"IT关联\",\"privacyLevel\":\"0\"},\"workspace\":null,\"official\":false,\"group\":null}}}'>\n</head><body><div id='root'></div><script>'use strict';var dataLayer = [{login: 'yes',gender: \"not_set\",user_id: \"87178177\",lang: \"zh\",illustup_flg: 'not_uploaded',premium: 'no',default_service_is_touch: 'no',}];</script>\n<!-- Google Tag Manager -->\n<noscript><iframe src=\"//www.googletagmanager.com/ns.html?id=GTM-55FG\"\nheight=\"0\" width=\"0\" style=\"display:none;visibility:hidden\"></iframe></noscript>\n<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':\nnew Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],\nj=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=\n'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);\n})(window,document,'script','dataLayer','GTM-55FG');</script>\n<!-- End Google Tag Manager -->\n<script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());let event_params = {'login': 'yes','p_ab_d_id': \"1115087350\",'default_service_is_touch': 'no',};gtag('set', 'user_properties', {'plan': 'normal','gender': '','user_id': \"87178177\",'lang': \"zh\",'illustup_flg': 'not_uploaded',});gtag('config', 'G-75BBYNYN9J', {...event_params});</script><span id=\"qualtrics_user-id\" hidden>87178177</span><span id=\"qualtrics_gender\" hidden>other</span><span id=\"qualtrics_age\" hidden>22</span><span id=\"qualtrics_language\" hidden>zh</span><span id=\"qualtrics_is-premium\" hidden>no</span><span id=\"qualtrics_is-user-is-illust-creator\" hidden>no</span><span id=\"qualtrics_is-user-is-manga-creator\" hidden>no</span><span id=\"qualtrics_is-user-is-novel-creator\" hidden>no</span><span id=\"qualtrics_default-service-is-touch\" hidden>no</span>\n    <script type='text/javascript'>\n        (function(){var g=function(e,h,f,g){\n            this.get=function(a){for(var a=a+\"=\",c=document.cookie.split(\";\"),b=0,e=c.length;b<e;b++){for(var d=c[b];\" \"==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};\n            this.set=function(a,c){var b=\"\",b=new Date;b.setTime(b.getTime()+6048E5);b=\"; expires=\"+b.toGMTString();document.cookie=a+\"=\"+c+b+\"; path=/; \"};\n            this.check=function(){var a=this.get(f);if(a)a=a.split(\":\");else if(100!=e)\"v\"==h&&(e=Math.random()>=e/100?0:100),a=[h,e,0],this.set(f,a.join(\":\"));else return!0;var c=a[1];if(100==c)return!0;switch(a[0]){case \"v\":return!1;case \"r\":return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(\":\")),!c}return!0};\n            this.go=function(){if(this.check()){var a=document.createElement(\"script\");a.type=\"text/javascript\";a.src=g;document.body&&document.body.appendChild(a)}};\n            this.start=function(){var t=this;\"complete\"!==document.readyState?window.addEventListener?window.addEventListener(\"load\",function(){t.go()},!1):window.attachEvent&&window.attachEvent(\"onload\",function(){t.go()}):t.go()};};\n            try{(new g(1,\"v\",\"QSI_S_ZN_5hF4My7Ad6VNNAi\",\"https://zn5hf4my7ad6vnnai-pixiv.siteintercept.qualtrics.com/SIE/?Q_ZID=ZN_5hF4My7Ad6VNNAi\")).start()}catch(i){}})();\n    </script><div id='ZN_5hF4My7Ad6VNNAi'></div>\n</body></html>"

	demoPixivDescription := pixivDescriptionRegex.FindStringSubmatch(demoPixivPage)

	t.Log(demoPixivDescription[1])
}

func TestPixivImageRegex(t *testing.T) {
	demoPixivContent := "<p>画师：pixiv事務局 - 阅览数：65970 - 收藏数：936</p><p><img src=\"https://pixiv.rsshub.app/img-original/img/2022/10/15/12/00/11/101947473_p0.png\" referrerpolicy=\"no-referrer\"></p><p><img src=\"https://pixiv.rsshub.app/img-original/img/2022/10/15/12/00/11/101947473_p1.png\" referrerpolicy=\"no-referrer\"></p><p><img src=\"https://pixiv.rsshub.app/img-original/img/2022/10/15/12/00/11/101947473_p2.png\" referrerpolicy=\"no-referrer\"></p><p><img src=\"https://pixiv.rsshub.app/img-original/img/2022/10/15/12/00/11/101947473_p3.png\" referrerpolicy=\"no-referrer\"></p><p><img src=\"https://pixiv.rsshub.app/img-original/img/2022/10/15/12/00/11/101947473_p4.png\" referrerpolicy=\"no-referrer\"></p><p><img src=\"https://pixiv.rsshub.app/img-original/img/2022/10/15/12/00/11/101947473_p5.png\" referrerpolicy=\"no-referrer\"></p><p><img src=\"https://pixiv.rsshub.app/img-original/img/2022/10/15/12/00/11/101947473_p6.png\" referrerpolicy=\"no-referrer\"></p><p><img src=\"https://pixiv.rsshub.app/img-original/img/2022/10/15/12/00/11/101947473_p7.png\" referrerpolicy=\"no-referrer\"></p><p><img src=\"https://pixiv.rsshub.app/img-original/img/2022/10/15/12/00/11/101947473_p8.png\" referrerpolicy=\"no-referrer\"></p><p><img src=\"https://pixiv.rsshub.app/img-original/img/2022/10/15/12/00/11/101947473_p9.png\" referrerpolicy=\"no-referrer\"></p>"

	demoPixivImages := pixivImageRegex.FindAllStringSubmatch(demoPixivContent, -1)

	for _, img := range demoPixivImages {
		t.Log(img[1])
	}
}
